dist: trusty
sudo: false
language: rust
rust:
  - stable
cache:
  - cargo: true
branches:
  only:
    - master
script: >-
  rm -rf target/doc &&
  cargo update &&
  cargo doc --all-features --no-deps -p failure -p tungstenite -p tokio-tungstenite -p walkdir &&
  cargo doc --all-features --no-deps -p tsukuyomi-server &&
  cargo doc --all-features --no-deps &&
  rm -f target/doc/.lock &&
  (echo '<meta http-equiv="refresh" content="0;URL=tsukuyomi/index.html">' > target/doc/index.html)
deploy:
  provider: pages
  skip_cleanup: true
  github_token: $GH_TOKEN
  repo: tsukuyomi-rs/tsukuyomi
  target_branch: gh-pages
  local_dir: target/doc
  on:
    branch: master
